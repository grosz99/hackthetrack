COMPREHENSIVE CODEBASE EXPLORATION REPORT
==========================================
Project: HackTheTrack - Racing Analytics AI Platform
Date: November 6, 2025
Exploration Level: VERY THOROUGH

================================================================================
1. COMPLETE PROJECT STRUCTURE MAP
================================================================================

ROOT DIRECTORY LAYOUT:
/Users/justingrosz/Documents/AI-Work/hackthetrack-master/
├── frontend/                     # React Vite application
│   ├── src/
│   │   ├── components/          # React components
│   │   ├── pages/               # Page components (Dashboard, Improve, RaceLog, Skills)
│   │   ├── context/             # React context (DriverContext)
│   │   ├── services/            # API services (api.js)
│   │   ├── data/                # Static JSON data files
│   │   └── utils/               # Utility functions
│   ├── config/                  # Configuration directory
│   │   └── vite.config.js       # CONFLICTING CONFIG (using 'classic' jsx)
│   ├── vite.config.js           # MAIN CONFIG (using 'automatic' jsx)
│   ├── package.json             # Dependencies including react-markdown ^10.1.0
│   └── dist/                    # Built output
│
├── backend/                      # FastAPI Python application
│   ├── app/
│   │   ├── api/
│   │   │   └── routes.py        # All API endpoints (42KB - needs splitting)
│   │   ├── services/            # Business logic
│   │   │   ├── data_loader.py
│   │   │   ├── ai_strategy.py
│   │   │   ├── ai_telemetry_coach.py
│   │   │   └── snowflake_service.py
│   │   └── data/                # Data files
│   ├── models/                  # Pydantic models
│   ├── database/                # Database connections
│   ├── tests/                   # Test suite
│   ├── main.py                  # FastAPI app entry point
│   ├── requirements.txt          # Python dependencies
│   └── .env                      # Credentials (EXPOSED!)
│
├── api/
│   └── index.py                 # Vercel serverless entry point
│
├── vercel.json                   # Vercel deployment config
├── build.sh                      # Build script
├── .vercelignore                 # Files to ignore in Vercel
├── .env                          # Root environment (EXPOSED!)
├── package.json                  # Root level (minimal)
└── [40+ markdown docs]           # Deployment guides and summaries

================================================================================
2. VITE CONFIGURATION CONFLICT DETECTED
================================================================================

ISSUE: TWO CONFLICTING VITE CONFIGS

File 1: /frontend/vite.config.js (MAIN - line 7)
   ├── jsxRuntime: 'automatic'    
   ├── sourcemap: true
   └── LOCATION: Root of frontend directory

File 2: /frontend/config/vite.config.js (ALTERNATE - line 7)
   ├── jsxRuntime: 'classic'       ← DIFFERENT!
   ├── sourcemap: false             ← DIFFERENT!
   └── LOCATION: In subdirectory

IMPACT: Vite uses the root config. The config/ directory version is unused and 
may cause confusion. The 'classic' runtime would require explicit React imports.

================================================================================
3. REACT-MARKDOWN ANALYSIS
================================================================================

LIBRARY: react-markdown ^10.1.0

USAGE LOCATIONS:
  ├── /frontend/src/pages/Improve/Improve.jsx (ONLY USAGE)
  │   ├── Line 13: import ReactMarkdown from 'react-markdown';
  │   └── Line 335: <ReactMarkdown className="coaching-markdown">

IMPORT ANALYSIS:
  ✓ CORRECT: Using default import pattern
  ✓ INSTALLED: Listed in package.json dependencies
  ✓ COMPATIBLE: react-markdown ^10.1.0 is ESM-compatible with Vite
  ✓ USAGE: Proper component usage in JSX

DEPLOYMENT STATUS:
  → No issues identified with react-markdown for Vercel deployment

================================================================================
4. ENVIRONMENT & CONFIGURATION FILES
================================================================================

ROOT LEVEL:
  ├── /.env (CRITICAL ISSUE!)
  │   ├── Contains: SNOWFLAKE_PASSWORD, ANTHROPIC_API_KEY, RSA_PUBLIC_KEY
  │   ├── Status: TRACKED IN GIT (found in git status)
  │   └── Risk: SECRETS EXPOSED IN REPOSITORY
  │
  └── /.env.production
      └── Status: Empty or minimal

BACKEND:
  ├── /backend/.env (CRITICAL ISSUE!)
  │   ├── Contains: SNOWFLAKE credentials, ANTHROPIC API KEY
  │   ├── Status: TRACKED IN GIT (found in git status)
  │   └── Risk: SECRETS EXPOSED IN REPOSITORY
  │
  ├── /backend/.env.example
  │   └── Status: Template only (safe)
  │
  └── /backend/.gitignore
      ├── ✓ Includes .env
      └── ✓ Includes backend/.env

FRONTEND:
  ├── /frontend/.env.example
  │   ├── Contains: VITE_API_URL=http://localhost:8000
  │   └── Status: Safe - template only
  │
  └── /frontend/.env.production
      ├── Contains: VITE_API_URL settings
      └── Status: Minimal production config

ROOT .gitignore:
  ├── ✓ Has: .env, .env.local, .env.*.local
  └── ✓ Has: backend/.env
  BUT: Both .env files are ALREADY COMMITTED and tracked!

================================================================================
5. LOCALHOST/HARDCODED URL ANALYSIS
================================================================================

FRONTEND API SERVICE (/frontend/src/services/api.js):
  Location: Line 8-18
  ┌─────────────────────────────────────────────────────────────────────┐
  │ const getApiBaseUrl = () => {                                        │
  │   if (import.meta.env.PROD) {                                       │
  │     return '';  // Empty string - routes include /api prefix        │
  │   }                                                                   │
  │   // Development: use environment variable or default to localhost  │
  │   return import.meta.env.VITE_API_URL || 'http://localhost:8000';  │
  │ };                                                                   │
  └─────────────────────────────────────────────────────────────────────┘
  
  ✓ CORRECT: Handles production vs development URLs properly
  ✓ CONFIGURABLE: Uses environment variable (VITE_API_URL)
  ✓ FALLBACK: Only uses localhost:8000 in development
  ✓ PRODUCTION: Empty string allows relative API calls

BACKEND CORS (/backend/main.py):
  Location: Line 24-38
  
  allowed_origins = [
      "http://localhost:5173",     # Development - Vite default
      "http://localhost:5174",     # Development - alt
      "http://localhost:5175",     # Development - alt 2
      "http://localhost:3000",     # Development - React alt
      "http://localhost:8000",     # Backend port
      "https://circuit-fbtth1gml-justin-groszs-projects.vercel.app",  # HARDCODED!
      "https://*.vercel.app"       # Wildcard for preview deployments
  ]

  ✓ ALLOWS: Vercel preview deployments
  ✗ ISSUE: Hardcoded production URL (specific to one deployment)
     → Should use environment variable: FRONTEND_URL from os.getenv()
     → Currently: os.getenv("FRONTEND_URL", "https://circuit-fbtth1gml...")

BUILD SCRIPT (/build.sh):
  Location: Line 29
  if [ ! -f "circuit-fit.db" ]; then
    echo "ERROR: Database file not found"
    exit 1
  fi
  
  ✗ ISSUE: Requires database file to exist at root
     → This will FAIL in Vercel (no pre-existing files)

================================================================================
6. CRITICAL SECURITY & DEPLOYMENT ISSUES
================================================================================

PRIORITY 1 - CRITICAL (Deployment will fail):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1.1 EXPOSED CREDENTIALS IN GIT REPOSITORY
   Files:
   • /.env (contains SNOWFLAKE_PASSWORD, ANTHROPIC_API_KEY)
   • /backend/.env (same sensitive data)
   
   Impact: HIGH - Anyone with repo access has production credentials
   Fix: 
   ├─ Remove from git history: git rm --cached .env backend/.env
   ├─ Add to .gitignore (already there but files committed)
   ├─ Rotate all credentials in .env files
   ├─ Update production secrets in Vercel dashboard
   └─ Never commit .env again

1.2 VERCEL BUILD SCRIPT REQUIRES NON-EXISTENT DATABASE FILE
   File: /build.sh (line 29-32)
   
   Issue: Checks for "circuit-fit.db" at root level
   Expected Location: /Users/justingrosz/Documents/AI-Work/hackthetrack-master/circuit-fit.db
   Vercel Behavior: This file WON'T exist on Vercel servers during build
   
   Impact: Build will FAIL with error "Database file not found"
   Fix:
   ├─ Change build.sh to not require database file
   ├─ Load database from environment or JSON data files
   ├─ Remove hardcoded database file check
   └─ OR: Ensure database is generated/downloaded during build

1.3 DUPLICATE/CONFLICTING VITE CONFIGURATIONS
   File 1: /frontend/vite.config.js (USED)
   File 2: /frontend/config/vite.config.js (UNUSED)
   
   Differences:
   ├─ jsxRuntime: 'automatic' vs 'classic'
   ├─ sourcemap: true vs false
   └─ Location conflict
   
   Impact: Confusion, potential build issues, technical debt
   Fix:
   ├─ Delete /frontend/config/vite.config.js (not used)
   ├─ Keep root /frontend/vite.config.js
   └─ Document that only root config is active

PRIORITY 2 - HIGH (May cause runtime issues):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2.1 ROUTES.PY FILE TOO LARGE
   File: /backend/app/api/routes.py
   Size: 42,113 bytes (42KB)
   Limit: CLAUDE.md specifies max 500 lines per file
   
   Impact: Violates code standards, hard to maintain
   Fix:
   ├─ Split routes.py into functional modules:
   │  ├─ routes_tracks.py
   │  ├─ routes_drivers.py
   │  ├─ routes_telemetry.py
   │  └─ routes_chat.py
   └─ Import routers in main routes.py

2.2 HARDCODED PRODUCTION FRONTEND URL
   File: /backend/main.py (line 33)
   
   production_url = os.getenv("FRONTEND_URL", 
       "https://circuit-fbtth1gml-justin-groszs-projects.vercel.app")
   
   Issue: Default hardcoded specific deployment URL
   Impact: Won't work for new deployments or staging
   Fix:
   ├─ Set FRONTEND_URL environment variable in Vercel
   ├─ Should NOT have a hardcoded default
   └─ Error if not set: raise ValueError("FRONTEND_URL not set")

2.3 API.JS IMPORT PATTERN COULD BE IMPROVED
   File: /frontend/src/services/api.js
   
   Current: Uses URL construction pattern
   Issue: Some endpoints might not match backend routes
   Status: ✓ Generally okay, but review error handling

PRIORITY 3 - MEDIUM (Best practices):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3.1 RSA PRIVATE KEY IN REPOSITORY
   Files: /rsa_key.p8, /rsa_key_new_backup.p8, /rsa_key_old.p8
   Status: Private key files TRACKED IN GIT
   
   Impact: CRITICAL security issue - anyone can access Snowflake
   Fix:
   ├─ Remove from git: git rm --cached rsa_key*.p8
   ├─ Add to .gitignore
   ├─ Rotate Snowflake service account
   ├─ Store key in Vercel secrets only
   └─ Never commit private keys

3.2 MULTIPLE .VERCEL DIRECTORIES
   Locations:
   ├─ /.vercel/
   ├─ /backend/.vercel/
   └─ Unclear which is primary
   
   Impact: Configuration confusion
   Fix:
   ├─ Standardize on single /.vercel directory
   ├─ Remove duplicate backend/.vercel
   └─ Document Vercel configuration

================================================================================
7. PACKAGE DEPENDENCIES ANALYSIS
================================================================================

ROOT PACKAGE.JSON:
  Location: /package.json
  Size: Minimal
  Contents: Only "vercel" as devDependency
  
  Impact: ✓ Correct - root doesn't need many dependencies

FRONTEND PACKAGE.JSON:
  Location: /frontend/package.json
  
  Key Dependencies:
  ├─ react: ^19.1.1             ✓ Latest
  ├─ react-dom: ^19.1.1         ✓ Latest
  ├─ react-markdown: ^10.1.0     ✓ Installed and working
  ├─ react-router-dom: ^7.9.4   ✓ Latest
  ├─ recharts: ^2.15.4          ✓ Charts library
  └─ plotly.js: ^3.1.2          ✓ Data visualization
  
  Missing Dependencies: None detected
  Status: ✓ All required deps installed

BACKEND REQUIREMENTS.TXT:
  Location: /backend/requirements.txt
  
  Key Packages:
  ├─ fastapi==0.115.6           ✓ Latest
  ├─ uvicorn==0.34.0            ✓ ASGI server
  ├─ python-dotenv==1.0.1       ✓ .env loading
  ├─ anthropic==0.47.0          ✓ Claude API
  ├─ pandas==2.2.3              ✓ Data processing
  ├─ pydantic==2.10.6           ✓ Data validation
  ├─ mangum==0.17.0             ✓ ASGI to WSGI adapter for Vercel
  ├─ snowflake-connector-python==3.6.0 ✓ Snowflake
  └─ requests==2.32.3           ✓ HTTP client
  
  Status: ✓ All critical packages present
  Note: mangum is correct choice for Vercel serverless

================================================================================
8. API ROUTING & ENTRY POINTS
================================================================================

BACKEND STRUCTURE:
  /backend/main.py (Entry Point)
  ├─ Creates FastAPI app
  ├─ Configures CORS with localhost and Vercel URLs
  ├─ Includes router from app.api.routes with /api prefix
  └─ Runs on port 8000
  
  /backend/app/api/routes.py (All Endpoints)
  ├─ GET /tracks          - Get all tracks
  ├─ GET /drivers         - Get all drivers
  ├─ POST /predict        - Circuit fit prediction
  ├─ POST /chat           - Strategy bot
  ├─ GET /telemetry/compare
  ├─ POST /telemetry/coaching
  └─ Plus 10+ other endpoints

SERVERLESS ENTRY POINT:
  /api/index.py (Vercel)
  ├─ Runs in serverless environment
  ├─ Imports main.py from /backend/main.py
  ├─ Exports app for Vercel's ASGI handler
  ├─ Sets DATABASE_PATH environment variable
  └─ Path setup: sys.path.insert(0, str(backend_dir))

FRONTEND ENTRY POINT:
  /frontend/src/main.jsx (React)
  ├─ Mounts React app
  └─ Imports from App.jsx

================================================================================
9. DEPLOYMENT CONFIGURATION
================================================================================

VERCEL.JSON:
  Location: /vercel.json
  Content:
  {
    "buildCommand": "cd frontend && npm ci && npm run build",
    "outputDirectory": "frontend/dist",
    "installCommand": "cd frontend && npm ci",
    "framework": null,
    "rewrites": [...]
  }
  
  ✗ ISSUE: Only builds frontend, not Python backend!
     → Should also run build.sh for Python setup
     → Should also ensure database availability
  
  Rewrites:
  ├─ /api/:path* → /api/index    ✓ Routes API to serverless
  └─ /(.*) → /index.html          ✓ SPA routing

.VERCELIGNORE:
  Location: /.vercelignore
  
  Excluded:
  ├─ /data/ (CSV files)
  ├─ node_modules/
  ├─ backend/venv/
  ├─ .env
  ├─ .git/
  └─ Various Python cache files
  
  Included (via exceptions):
  ├─ frontend/src/data/dashboardData.json
  ├─ backend/data/driver_factors.json
  ├─ backend/data/driver_season_stats.json
  └─ backend/data/driver_race_results.json
  
  ✗ MISSING: Should exclude rsa_key*.p8 files

BUILD.SH:
  Location: /build.sh
  
  Steps:
  1. Install Python dependencies
  2. Build React frontend
  3. Verify frontend/dist exists
  4. Verify circuit-fit.db exists  ← WILL FAIL ON VERCEL
  
  Status: ✓ Most steps correct, but database check will fail

================================================================================
10. DATA FILES & SOURCES
================================================================================

CRITICAL DATA FILES:
  Location: /backend/data/
  Files:
  ├─ driver_factors.json          (204KB) ✓ Included in deployment
  ├─ driver_season_stats.json     (11KB)  ✓ Included in deployment
  ├─ driver_race_results.json     (288KB) ✓ Included in deployment
  └─ dashboardData.json           (64KB)  ✓ Included in deployment
  
  Total: 567KB of JSON data
  Status: ✓ Properly excluded from .vercelignore exceptions

DATABASE:
  Location: /circuit-fit.db
  Status: SQLite database (139KB)
  Issue: build.sh requires this file to exist
  
  Problem: File exists locally but won't exist on Vercel
  Solution: Either:
  ├─ Load data from JSON files instead of database
  ├─ Generate database during build from JSON
  └─ Download database from cloud storage during build

SNOWFLAKE CONNECTION:
  Status: Configured
  Usage: Telemetry data storage (from .env)
  Credentials: Stored in environment variables (exposed in .env!)

================================================================================
11. SUMMARY OF ALL ISSUES FOUND
================================================================================

BLOCKING ISSUES (Prevent Deployment):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. ✗ CRITICAL: Exposed .env files in git (with secrets)
   → Location: /.env, /backend/.env
   → Solution: Remove, rotate credentials, set in Vercel

2. ✗ CRITICAL: circuit-fit.db required but won't exist on Vercel
   → Location: /build.sh line 29-32
   → Solution: Remove database file check or generate during build

3. ✗ CRITICAL: RSA private keys tracked in git
   → Location: /rsa_key*.p8 files
   → Solution: Remove from git, store in Vercel secrets

4. ✗ HIGH: Vercel config only builds frontend, not backend setup
   → Location: /vercel.json
   → Solution: Update buildCommand to handle Python + frontend

CONFIGURATION ISSUES:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5. ✗ Duplicate vite config files
   → Locations: /frontend/vite.config.js AND /frontend/config/vite.config.js
   → Impact: Confusion, cleanup needed
   → Solution: Delete /frontend/config/vite.config.js

6. ✗ Hardcoded frontend URL as default
   → Location: /backend/main.py line 33
   → Solution: Require environment variable, no default

7. ✗ API URL might not match in all environments
   → Location: /frontend/src/services/api.js
   → Status: Actually okay with env vars
   → Verify: VITE_API_URL set in Vercel

CODE QUALITY ISSUES:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
8. ✗ routes.py too large (42KB)
   → Should be split into 4-5 modules
   → Violates 500-line max per file guideline

9. ✗ Multiple .vercel directories
   → Unclear which is authoritative
   → Needs cleanup and documentation

================================================================================
12. REACT-MARKDOWN STATUS - VERIFIED SAFE
================================================================================

✓ Import: Correct - using default import from 'react-markdown'
✓ Package: Installed - ^10.1.0 in frontend/package.json
✓ Usage: Proper - used in Improve.jsx on line 335
✓ Compatibility: ESM-compatible with Vite
✓ Deployment: No issues for Vercel deployment

The react-markdown usage is NOT causing deployment issues.
No action needed for react-markdown itself.

================================================================================
13. DIRECTORY STRUCTURE RECOMMENDATIONS
================================================================================

CURRENT ISSUE: Multiple api/index.py files and conflicting configs

Current Structure:
├── /api/index.py                      ← Vercel serverless entry
├── /backend/api/                      ← Routes directory (confusing)
│   ├── __init__.py
│   └── routes.py                      ← All endpoints (42KB!)
└── /backend/main.py                   ← FastAPI app

Better Structure:
├── /api/index.py                      ← Keep: Vercel entry
├── /backend/app/
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes/
│   │   │   ├── __init__.py
│   │   │   ├── tracks.py
│   │   │   ├── drivers.py
│   │   │   ├── telemetry.py
│   │   │   ├── chat.py
│   │   │   └── health.py
│   │   └── models.py              ← Consolidate models
│   └── services/                   ← Existing structure OK
└── /backend/main.py                ← Keep: FastAPI app

================================================================================
RECOMMENDATIONS SUMMARY
================================================================================

IMMEDIATE ACTIONS (Before Next Deployment):
1. Remove .env and rsa_key*.p8 from git history
2. Rotate all credentials
3. Fix build.sh database check
4. Delete /frontend/config/vite.config.js
5. Update vercel.json buildCommand for Python setup

FOLLOW-UP ACTIONS:
6. Split routes.py into functional modules
7. Set FRONTEND_URL in Vercel environment variables
8. Verify database handling strategy
9. Clean up duplicate .vercel directories
10. Update .vercelignore to exclude rsa_key*.p8

QUALITY IMPROVEMENTS:
11. Add environment variable validation
12. Document Vercel setup process
13. Add deployment checklist
14. Create database initialization guide
15. Implement database source strategy (JSON vs SQLite vs Snowflake)

================================================================================
